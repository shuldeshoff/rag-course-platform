# Модуль 2: Что такое RAG

## Цели модуля
- Понять проблемы чистых LLM
- Освоить концепцию RAG
- Изучить архитектуру RAG-систем
- Сравнить RAG с fine-tuning

## Лекция: Retrieval-Augmented Generation

### 1. Проблемы чистых LLM

**Галлюцинации:**
```
Q: Кто был первым президентом Марса?
A: Илон Маск был избран первым президентом Марса в 2045 году...
```
❌ LLM выдумывает несуществующие факты

**Устаревшие данные:**
- Модель обучена до cutoff date
- Не знает свежих событий
- Не знает внутренних документов компании

**Отсутствие специфичных знаний:**
- Корпоративная документация
- Технические спецификации
- Персональные данные

### 2. Концепция RAG

**RAG = Retrieval + Augmentation + Generation**

```
Вопрос → Поиск релевантных документов →
    → Добавление в контекст →
    → LLM генерирует ответ
```

**Преимущества:**
✅ Актуальная информация
✅ Ссылки на источники
✅ Меньше галлюцинаций
✅ Дешевле fine-tuning
✅ Легко обновлять базу знаний

### 3. Архитектура RAG

```
┌─────────────┐
│   Question  │
└──────┬──────┘
       │
       ▼
┌─────────────────┐
│  Embedding      │ ← sentence-transformers
└──────┬──────────┘
       │
       ▼
┌─────────────────┐
│ Vector Search   │ ← Qdrant/Pinecone
│ (Similarity)    │
└──────┬──────────┘
       │
       ▼
┌─────────────────┐
│  Top-K Chunks   │
└──────┬──────────┘
       │
       ▼
┌─────────────────┐
│ Prompt Builder  │
└──────┬──────────┘
       │
       ▼
┌─────────────────┐
│   LLM (GPT)     │ ← YandexGPT
└──────┬──────────┘
       │
       ▼
┌─────────────────┐
│     Answer      │
└─────────────────┘
```

### 4. Компоненты RAG

**1. Retriever (Поисковик)**
- Преобразует вопрос в embedding
- Ищет похожие векторы в базе
- Возвращает топ-K документов

**2. Augmentation (Дополнение)**
- Формирует контекст из найденных документов
- Создает промпт для LLM
- Оптимизирует под лимит токенов

**3. Generator (Генератор)**
- Получает вопрос + контекст
- Генерирует ответ на основе контекста
- Может указывать источники

### 5. RAG vs Fine-tuning

| Критерий | RAG | Fine-tuning |
|----------|-----|-------------|
| Стоимость | Низкая | Высокая |
| Обновление | Легко | Переобучение |
| Прозрачность | Видны источники | Черный ящик |
| Точность | Высокая | Очень высокая |
| Скорость | Средняя | Быстрая |

**Когда использовать RAG:**
- Часто обновляемые данные
- Большие документы
- Нужна прозрачность
- Ограниченный бюджет

**Когда fine-tuning:**
- Специфичный стиль
- Критична скорость
- Статичные данные
- Большой бюджет

### 6. Типы RAG

**Naive RAG:**
```
Question → Embed → Search → Generate
```

**Advanced RAG:**
- Гибридный поиск (keyword + semantic)
- Ре-ранжирование результатов
- Фильтрация по метаданным

**Modular RAG:**
- Несколько retrieval стратегий
- Адаптивный выбор chunks
- Self-reflection

### 7. Метрики качества RAG

**Retrieval метрики:**
- Precision@K - точность в топ-K
- Recall - полнота поиска
- MRR - Mean Reciprocal Rank

**Generation метрики:**
- Relevance - релевантность ответа
- Faithfulness - соответствие источникам
- Answer similarity - сходство с эталоном

## Практическое задание

Спроектируйте RAG-систему для:
1. Техподдержки интернет-магазина
2. Корпоративной wiki
3. Образовательного курса

Опишите:
- Источники данных
- Стратегию chunking
- Критерии поиска
- Промпт-шаблоны

## Тест

1. В чем главное преимущество RAG перед чистым LLM?
2. Назовите три компонента RAG
3. Когда лучше использовать fine-tuning вместо RAG?
4. Что такое naive RAG?
5. Какие метрики используются для оценки retrieval?

